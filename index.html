<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>香氛精油管理系統 | Aroma Manager</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              forest: {
                50: '#f2fcf5', 100: '#e1f8e8', 200: '#c3efd2', 300: '#94e0b3',
                400: '#5cc78e', 500: '#34ae6f', 600: '#258c57', 700: '#217048',
                800: '#1e593c', 900: '#194933', 950: '#0c281d',
              },
              paper: {
                50: '#fafaf9', 100: '#f5f5f4', 200: '#e7e5e4',
              }
            },
            fontFamily: {
              serif: ['Georgia', 'Cambria', 'Times New Roman', 'Times', 'serif'],
              sans: ['ui-sans-serif', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
            }
          }
        }
      }
    </script>
    <style>
      body { background-color: #fafaf9; color: #1c1917; }
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #f5f5f4; }
      ::-webkit-scrollbar-thumb { background: #94e0b3; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #5cc78e; }
      .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <!-- 2. Babel for JSX/TypeScript compilation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "firebase/": "https://esm.sh/firebase@^12.8.0/",
    "vite": "https://esm.sh/vite@^7.3.1",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <!-- 3. MAIN APPLICATION SCRIPT -->
    <script type="text/babel" data-type="module" data-presets="react,typescript">
      import React, { useState, useEffect, useMemo } from 'https://esm.sh/react@18.2.0';
      import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
      import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js';
      import { getFirestore, collection, getDocs, addDoc, updateDoc, doc } from 'https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js';

      // --- TYPES ---
      interface ChemicalMolecule {
        name: string;
        percentage: string;
      }
      interface Literature {
        level: string;
        subjects: string;
        conclusion: string;
      }
      interface Recipe {
        concentration: string;
        oilDrops: string;
        carrierOil: string;
        usageMethod: string;
        frequency: string;
      }
      interface EssentialOil {
        id: string;
        name: string;
        latinName: string;
        hashtags: string[];
        summary: string;
        chemicalFamily: string;
        molecules: ChemicalMolecule[];
        physiological: string;
        psychological: string;
        painManagement: string;
        safety: string;
        literature?: Literature;
        recipe?: Recipe;
        createdAt?: number;
      }
      enum ViewState {
        LIST = 'LIST',
        DETAIL = 'DETAIL',
        EDIT = 'EDIT',
        CREATE = 'CREATE'
      }

      // --- DATA CONSTANTS ---
      const INITIAL_OILS = [
        // ... (貼入您的資料，為節省空間保留部分範例，完整程式碼請確保包含所有70隻精油) ...
        {
          name: "真正薰衣草",
          latinName: "Lavandula angustifolia",
          hashtags: ["鎮靜", "睡眠", "燒燙傷", "皮膚"],
          summary: "精油界的萬用刀。以促進放鬆和安穩睡眠而聞名。",
          chemicalFamily: "酯類",
          molecules: [{ name: "乙酸芳樟酯", percentage: "30-45%" }, { name: "芳樟醇", percentage: "25-38%" }],
          physiological: "止痛、抗菌、抗發炎、抗痙攣。極佳的燒燙傷、傷口修復及皮膚再生功效。",
          psychological: "平衡神經系統。有助於焦慮、憂鬱和失眠。",
          painManagement: "頭痛、肌肉痠痛、抽筋。",
          safety: "公認安全 (GRAS)。無毒、無刺激性。",
          literature: { level: "Level 1 (RCT)", subjects: "80位產後婦女", conclusion: "吸嗅薰衣草精油顯著降低了產後憂鬱評分，並改善了睡眠品質 (P < 0.05)。" },
          recipe: { concentration: "3%", oilDrops: "真正薰衣草 4滴 + 甜橙 2滴", carrierOil: "10ml 甜杏仁油", usageMethod: "全身按摩或針對肩頸放鬆按摩。", frequency: "每晚睡前一次。" }
        },
        {
          name: "茶樹",
          latinName: "Melaleuca alternifolia",
          hashtags: ["殺菌", "免疫", "痘痘"],
          summary: "家庭急救箱必備，強大的廣譜殺菌劑。",
          chemicalFamily: "單萜醇",
          molecules: [{ name: "4-松油烯醇", percentage: "35-48%" }, { name: "γ-松油烯", percentage: "10-28%" }],
          physiological: "抗細菌、病毒、黴菌。治療香港腳、念珠菌、痤瘡。",
          psychological: "提振精神，掃除陰霾。",
          painManagement: "感染引起的紅腫痛。",
          safety: "氧化後可能刺激皮膚。貓科動物代謝較慢需小心。"
        },
        // ... (您可以隨時貼回其他的精油資料) ...
        // 為了確保單檔能運行，這裡我僅放回兩筆作為示範。
        // 請將您原本 constants.ts 中的所有資料複製貼上覆蓋此處的 INITIAL_OILS 陣列。
      ];

      // --- FIREBASE SERVICE ---
      const firebaseConfig = {
        apiKey: "AIzaSyAU0V8emIBE1kAtYnQ_7V8FDIhMGpxPCDk",
        authDomain: "naha-aroma.firebaseapp.com",
        projectId: "naha-aroma",
        storageBucket: "naha-aroma.firebasestorage.app",
        messagingSenderId: "89052525408",
        appId: "1:89052525408:web:b6c8d777baa9491624e405",
        measurementId: "G-WZFHJ095R7"
      };

      let db = null;
      let isOfflineMode = true;

      if (firebaseConfig.apiKey && firebaseConfig.projectId) {
        try {
          const app = initializeApp(firebaseConfig);
          db = getFirestore(app);
          isOfflineMode = false;
        } catch (error) {
          console.warn("Firebase fallback:", error);
        }
      }

      const LOCAL_STORAGE_KEY = 'aroma_manager_oils_v1';
      const getLocalOils = () => {
        const stored = localStorage.getItem(LOCAL_STORAGE_KEY);
        if (!stored) {
          const seeded = INITIAL_OILS.map(oil => ({ ...oil, id: crypto.randomUUID(), createdAt: Date.now() }));
          localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(seeded));
          return seeded;
        }
        return JSON.parse(stored);
      };
      const saveLocalOils = (oils) => localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(oils));

      const getOils = async () => {
        if (isOfflineMode || !db) {
          await new Promise(r => setTimeout(r, 500));
          return getLocalOils();
        }
        try {
          const querySnapshot = await getDocs(collection(db, "oils"));
          const oils = [];
          querySnapshot.forEach((doc) => oils.push({ id: doc.id, ...doc.data() }));
          if (oils.length === 0) {
            for (const oil of INITIAL_OILS) {
              await addDoc(collection(db, "oils"), { ...oil, createdAt: Date.now() });
            }
            return getLocalOils(); // Return local seed while cloud populates
          }
          return oils;
        } catch (error) {
          console.error("Firestore Error:", error);
          return getLocalOils();
        }
      };

      const addOil = async (oil) => {
        if (isOfflineMode || !db) {
          await new Promise(r => setTimeout(r, 500));
          const newOil = { ...oil, id: crypto.randomUUID(), createdAt: Date.now() };
          saveLocalOils([...getLocalOils(), newOil]);
          return newOil;
        }
        try {
          const docRef = await addDoc(collection(db, "oils"), { ...oil, createdAt: Date.now() });
          return { id: docRef.id, ...oil };
        } catch (e) { console.error(e); throw e; }
      };

      const updateOil = async (id, updates) => {
        if (isOfflineMode || !db) {
          await new Promise(r => setTimeout(r, 500));
          const current = getLocalOils();
          const updated = current.map(o => o.id === id ? { ...o, ...updates } : o);
          saveLocalOils(updated);
          return;
        }
        try {
          await updateDoc(doc(db, "oils", id), updates);
        } catch (e) { console.error(e); throw e; }
      };

      // --- COMPONENTS ---
      
      // Icons
      const Icons = {
        Search: () => <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5 text-forest-700"><path strokeLinecap="round" strokeLinejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" /></svg>,
        Plus: () => <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>,
        ArrowLeft: () => <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" /></svg>,
        Edit: () => <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-5 h-5"><path strokeLinecap="round" strokeLinejoin="round" d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" /></svg>,
        Book: () => <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={1.5} stroke="currentColor" className="w-6 h-6"><path strokeLinecap="round" strokeLinejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" /></svg>
      };

      // OilForm Component
      const OilForm = ({ initialData, onSubmit, onCancel }) => {
        const [formData, setFormData] = useState({
          name: '', latinName: '', hashtags: [], summary: '', chemicalFamily: '',
          molecules: [{ name: '', percentage: '' }],
          physiological: '', psychological: '', painManagement: '', safety: '',
          literature: { level: '', subjects: '', conclusion: '' },
          recipe: { concentration: '', oilDrops: '', carrierOil: '', usageMethod: '', frequency: '' }
        });
        const [loading, setLoading] = useState(false);
        const [tagInput, setTagInput] = useState('');

        useEffect(() => {
          if (initialData) {
            setFormData({
              ...initialData,
              hashtags: initialData.hashtags || [],
              molecules: initialData.molecules?.length ? initialData.molecules : [{ name: '', percentage: '' }],
              literature: initialData.literature || { level: '', subjects: '', conclusion: '' },
              recipe: initialData.recipe || { concentration: '', oilDrops: '', carrierOil: '', usageMethod: '', frequency: '' }
            });
          }
        }, [initialData]);

        const handleChange = (e) => setFormData(p => ({ ...p, [e.target.name]: e.target.value }));
        const handleNested = (sec, field, val) => setFormData(p => ({ ...p, [sec]: { ...p[sec], [field]: val } }));
        const handleMol = (idx, field, val) => {
          const m = [...formData.molecules]; m[idx] = { ...m[idx], [field]: val };
          setFormData(p => ({ ...p, molecules: m }));
        };

        const handleSubmit = async (e) => {
          e.preventDefault();
          setLoading(true);
          try {
            await onSubmit({ ...formData, molecules: formData.molecules.filter(m => m.name.trim()) });
          } catch(e) { alert('Error'); } finally { setLoading(false); }
        };

        return (
          <div className="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg border-t-4 border-forest-600 animate-fade-in">
            <h2 className="text-3xl font-serif text-forest-900 mb-8 font-bold text-center">{initialData ? '編輯精油' : '新增精油'}</h2>
            <form onSubmit={handleSubmit} className="space-y-6">
              <div className="grid md:grid-cols-2 gap-4">
                <input required name="name" value={formData.name} onChange={handleChange} placeholder="精油名稱" className="w-full px-4 py-2 border rounded-md" />
                <input required name="latinName" value={formData.latinName} onChange={handleChange} placeholder="拉丁學名" className="w-full px-4 py-2 border rounded-md italic" />
              </div>
              <textarea required name="summary" value={formData.summary} onChange={handleChange} placeholder="簡介" rows={2} className="w-full px-4 py-2 border rounded-md" />
              
              <div className="space-y-2">
                <label className="font-bold text-forest-800">Hashtags</label>
                <div className="flex flex-wrap gap-2">
                  {formData.hashtags.map(t => <span key={t} onClick={() => setFormData(p => ({...p, hashtags: p.hashtags.filter(x => x!==t)}))} className="bg-forest-50 px-2 py-1 rounded cursor-pointer">#{t} &times;</span>)}
                </div>
                <input value={tagInput} onChange={e => setTagInput(e.target.value)} onKeyDown={e => {
                  if(e.key === 'Enter' && tagInput.trim()) {
                    e.preventDefault();
                    if(!formData.hashtags.includes(tagInput.trim())) setFormData(p => ({...p, hashtags: [...p.hashtags, tagInput.trim()]}));
                    setTagInput('');
                  }
                }} placeholder="輸入 Tag 按 Enter..." className="w-full px-4 py-2 border rounded-md" />
              </div>

              <div className="bg-gray-50 p-4 rounded">
                <h3 className="font-bold mb-2">化學分子</h3>
                {formData.molecules.map((m, i) => (
                  <div key={i} className="flex gap-2 mb-2">
                    <input value={m.name} onChange={e => handleMol(i, 'name', e.target.value)} placeholder="名稱" className="flex-1 px-2 py-1 border rounded" />
                    <input value={m.percentage} onChange={e => handleMol(i, 'percentage', e.target.value)} placeholder="%" className="w-20 px-2 py-1 border rounded" />
                  </div>
                ))}
                <button type="button" onClick={() => setFormData(p => ({...p, molecules: [...p.molecules, {name:'', percentage:''}]}))} className="text-sm text-forest-600">+ 新增</button>
              </div>

              <div className="space-y-4">
                 <input name="chemicalFamily" value={formData.chemicalFamily} onChange={handleChange} placeholder="化學家族 (如: 酯類)" className="w-full px-4 py-2 border rounded-md" />
                 <textarea name="physiological" value={formData.physiological} onChange={handleChange} placeholder="生理療效" className="w-full px-4 py-2 border rounded-md" />
                 <textarea name="psychological" value={formData.psychological} onChange={handleChange} placeholder="心理療效" className="w-full px-4 py-2 border rounded-md" />
                 <textarea name="painManagement" value={formData.painManagement} onChange={handleChange} placeholder="疼痛管理" className="w-full px-4 py-2 border rounded-md" />
                 <textarea name="safety" value={formData.safety} onChange={handleChange} placeholder="安全注意事項" className="w-full px-4 py-2 border border-red-200 bg-red-50 rounded-md" />
              </div>

              <div className="flex gap-4">
                <button type="submit" className="flex-1 bg-forest-900 text-white py-3 rounded-lg hover:bg-forest-800">{loading ? '儲存中...' : '儲存'}</button>
                <button type="button" onClick={onCancel} className="px-6 py-3 border rounded-lg hover:bg-gray-50">取消</button>
              </div>
            </form>
          </div>
        );
      };

      // OilCard Component
      const OilCard = ({ oil, onSelect }) => {
        const family = oil.chemicalFamily ? oil.chemicalFamily.split(/[,，、]/)[0].trim() : '';
        return (
          <div onClick={() => onSelect(oil)} className="bg-white rounded-lg shadow-sm hover:shadow-lg border-l-4 border-forest-500 overflow-hidden cursor-pointer group flex flex-col h-full p-5 transition-all">
            <div className="flex justify-between items-start mb-1">
              <h3 className="font-serif text-xl text-forest-900 font-bold group-hover:text-forest-600">{oil.name}</h3>
              {family && <span className="text-xs font-bold text-amber-800 bg-amber-50 px-2 py-1 rounded border border-amber-100">{family}</span>}
            </div>
            <p className="text-sm text-forest-600 italic mb-3 font-serif">{oil.latinName}</p>
            <div className="mb-4 bg-gray-50 rounded p-2 border border-gray-100">
              {oil.molecules.slice(0, 2).map((m, i) => (
                <div key={i} className="flex justify-between text-xs"><span className="text-gray-700">{m.name}</span><span className="text-gray-500 font-mono">{m.percentage}</span></div>
              ))}
            </div>
            <p className="text-gray-600 text-sm line-clamp-3 mb-4 flex-grow">{oil.summary}</p>
            <div className="flex flex-wrap gap-1 mt-auto">
              {oil.hashtags.slice(0, 3).map(t => <span key={t} className="text-[10px] bg-forest-50 text-forest-700 px-2 py-1 rounded-full border border-forest-100">#{t}</span>)}
            </div>
          </div>
        );
      };

      // DetailView Component
      const DetailView = ({ oil, onBack, onEdit }) => (
        <div className="max-w-4xl mx-auto animate-fade-in pb-10">
          <div className="mb-6 flex items-center justify-between">
            <button onClick={onBack} className="flex items-center text-forest-700 font-medium"><Icons.ArrowLeft /><span className="ml-2">返回</span></button>
            <button onClick={() => onEdit(oil)} className="flex items-center bg-paper-200 px-4 py-2 rounded-lg text-sm font-medium"><Icons.Edit /><span className="ml-2">編輯</span></button>
          </div>
          <div className="bg-white rounded-xl shadow-lg overflow-hidden">
            <div className="bg-forest-900 text-white p-8">
              <h1 className="text-3xl font-serif font-bold">{oil.name}</h1>
              <p className="text-forest-200 text-xl italic font-serif">{oil.latinName}</p>
              <div className="flex flex-wrap gap-2 mt-4">{oil.hashtags.map(t => <span key={t} className="bg-white/10 px-3 py-1 rounded-full text-sm">#{t}</span>)}</div>
            </div>
            <div className="p-8 space-y-8">
              <div><h3 className="text-sm font-bold uppercase tracking-wider text-forest-900 mb-2">簡介</h3><p className="text-lg text-gray-700">{oil.summary}</p></div>
              <div>
                <h3 className="text-2xl font-serif font-bold text-forest-900 mb-4">化學成分</h3>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                  {oil.molecules.map((m, i) => <div key={i} className="flex justify-between p-3 bg-gray-50 rounded border"><span className="font-medium text-gray-800">{m.name}</span><span className="text-forest-600 font-bold">{m.percentage}</span></div>)}
                </div>
              </div>
              <div className="grid md:grid-cols-2 gap-8">
                <div><h3 className="text-xl font-serif font-bold text-forest-900 mb-2 flex items-center"><span className="w-2 h-6 bg-amber-500 mr-2 rounded-full"></span>生理療效</h3><p className="bg-paper-50 p-4 rounded text-gray-600">{oil.physiological}</p></div>
                <div><h3 className="text-xl font-serif font-bold text-forest-900 mb-2 flex items-center"><span className="w-2 h-6 bg-purple-400 mr-2 rounded-full"></span>心理療效</h3><p className="bg-paper-50 p-4 rounded text-gray-600">{oil.psychological}</p></div>
              </div>
              {oil.painManagement && <div><h3 className="text-xl font-serif font-bold text-forest-900 mb-2 flex items-center"><span className="w-2 h-6 bg-red-400 mr-2 rounded-full"></span>疼痛管理</h3><p className="bg-paper-50 p-4 rounded text-gray-600">{oil.painManagement}</p></div>}
              <div className="bg-red-50 border-l-4 border-red-500 p-6"><h3 className="text-red-900 font-bold mb-2">安全注意</h3><p className="text-red-800">{oil.safety}</p></div>
              
              {/* Literature & Recipe */}
              {(oil.literature?.conclusion || oil.recipe?.usageMethod) && (
                <div className="bg-slate-50 rounded-xl border border-slate-200 mt-4 overflow-hidden">
                   <div className="bg-slate-100 px-6 py-4 border-b flex items-center"><Icons.Book /><h3 className="ml-2 font-bold text-slate-800">文獻與配方</h3></div>
                   <div className="p-6 space-y-6">
                      {oil.literature?.conclusion && (
                        <div>
                          <div className="grid md:grid-cols-2 gap-4 mb-4">
                            <div className="bg-white p-3 rounded border"><p className="text-xs font-bold text-slate-500">對象</p><p>{oil.literature.subjects}</p></div>
                            <div className="bg-white p-3 rounded border"><p className="text-xs font-bold text-slate-500">等級</p><p>{oil.literature.level}</p></div>
                          </div>
                          <p className="text-xs font-bold text-slate-500">結論</p>
                          <div className="bg-white p-4 rounded border">{oil.literature.conclusion}</div>
                        </div>
                      )}
                      {oil.recipe?.usageMethod && (
                         <div className="bg-slate-100/50 p-4 rounded border">
                            <h4 className="font-bold text-amber-900 mb-2">建議配方</h4>
                            <p><strong>濃度:</strong> {oil.recipe.concentration} | <strong>基底:</strong> {oil.recipe.carrierOil}</p>
                            <p className="my-2 bg-white p-2 rounded border"><strong>配方:</strong> {oil.recipe.oilDrops}</p>
                            <p><strong>用法:</strong> {oil.recipe.usageMethod} ({oil.recipe.frequency})</p>
                         </div>
                      )}
                   </div>
                </div>
              )}
            </div>
          </div>
        </div>
      );

      // --- APP COMPONENT ---
      const App = () => {
        const [oils, setOils] = useState([]);
        const [view, setView] = useState('LIST');
        const [selected, setSelected] = useState(null);
        const [query, setQuery] = useState('');
        const [loading, setLoading] = useState(true);

        useEffect(() => {
          getOils().then(data => { setOils(data); setLoading(false); });
        }, []);

        const filtered = useMemo(() => {
          if (!query) return oils;
          const q = query.toLowerCase();
          return oils.filter(o => o.name.includes(q) || o.latinName.toLowerCase().includes(q) || o.hashtags.some(t => t.includes(q)) || o.molecules.some(m => m.name.includes(q)));
        }, [oils, query]);

        const handleSave = async (data) => {
          if (view === 'EDIT' && selected) {
            await updateOil(selected.id, data);
            setOils(p => p.map(o => o.id === selected.id ? { ...data, id: selected.id } : o));
            setSelected({ ...data, id: selected.id });
            setView('DETAIL');
          } else {
            const newOil = await addOil(data);
            setOils(p => [...p, newOil]);
            setView('LIST');
          }
        };

        return (
          <div className="min-h-screen bg-paper-50 font-sans text-gray-800">
            <nav className="bg-forest-900 text-white sticky top-0 z-50 shadow-lg px-4 py-4">
              <div className="container mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
                <div className="flex items-center gap-2 cursor-pointer" onClick={() => {setView('LIST'); setSelected(null);}}>
                  <div className="w-8 h-8 bg-amber-500 rounded-tr-xl rounded-bl-xl"></div>
                  <span className="text-2xl font-serif font-bold">香氛精油管理</span>
                </div>
                <div className="relative flex-1 max-w-lg w-full">
                  <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><Icons.Search /></div>
                  <input value={query} onChange={e => setQuery(e.target.value)} placeholder="搜尋精油..." className="w-full pl-10 pr-4 py-2 rounded-full bg-forest-800 border-none text-white placeholder-forest-300 focus:ring-2 focus:ring-amber-500 focus:outline-none" />
                </div>
                <button onClick={() => {setSelected(null); setView('CREATE');}} className="hidden md:flex items-center bg-amber-600 px-4 py-2 rounded-full font-medium shadow hover:bg-amber-700"><Icons.Plus /><span className="ml-1">新增</span></button>
              </div>
            </nav>
            <main className="container mx-auto px-4 pt-8">
              {loading ? <div className="text-center py-20">載入中...</div> : (
                <>
                  {view === 'LIST' && (
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                      {filtered.map(o => <OilCard key={o.id} oil={o} onSelect={(oil) => { setSelected(oil); setView('DETAIL'); window.scrollTo(0,0); }} />)}
                    </div>
                  )}
                  {view === 'DETAIL' && selected && <DetailView oil={selected} onBack={() => setView('LIST')} onEdit={(oil) => { setSelected(oil); setView('EDIT'); }} />}
                  {(view === 'EDIT' || view === 'CREATE') && <OilForm initialData={view === 'EDIT' ? selected : undefined} onSubmit={handleSave} onCancel={() => view === 'EDIT' ? setView('DETAIL') : setView('LIST')} />}
                </>
              )}
            </main>
            {view === 'LIST' && <button onClick={() => {setSelected(null); setView('CREATE');}} className="md:hidden fixed bottom-6 right-6 w-14 h-14 bg-amber-600 text-white rounded-full shadow-xl flex items-center justify-center z-50"><Icons.Plus /></button>}
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
</body>
</html>